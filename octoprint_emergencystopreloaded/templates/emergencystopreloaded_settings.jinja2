<h3>{{ _('Emergency Stop Reloaded') }}</h3>
<form id="emergencystopreloaded_settings" class="form-horizontal">
    <div class="alert alert-info" data-bind="visible: printing">
        <i class="fas icon-lock fa-hourglass-half iconRight"></i>
        {{ _('All settings are disabled while printing') }}
    </div>

    <h4>{{ _('Sensor setup') }}</h4>

    <div class="control-group">
        <label class="control-label" for="emergencystopreloaded_settings_gpioMode">{{ _('Board mode') }}</label>
        <div class="controls">
            <select title="{{ _('Board - referring to the pins by the number, BCM - referring to the pins by the Broadcom SOC channel') }}" id="emergencystopreloaded_settings_gpioMode" data-bind="value: settingsViewModel.settings.plugins.emergencystopreloaded.gpio_mode, disable:gpio_mode_disabled() || printing()" required>
                <option value=10>{{ _('Physical / Board mode') }}</option>
                <option value=11>{{ _('GPIO / BCM mode') }}</option>
            </select>
            <div class="alert alert-info" data-bind="visible: gpio_mode_disabled">
                <i class="fas fa-info icon-info-sign iconRight"></i>
                {{ _('Board mode has been set by third party/other plugin and is disabled') }}
            </div>
        </div>
    </div>

    <div class="control-group">
        <label class="control-label" for="emergencystopreloaded_settings_pinInput">{{ _('Pin number') }}</label>
        <div class="controls">
            <input id="emergencystopreloaded_settings_pinInput" type="number" step="1" min="0" max="40" class="input-mini" data-bind="value: settingsViewModel.settings.plugins.emergencystopreloaded.pin, disable:printing" required>
            <span class="help-block">Which Raspberry Pi pin is your button output attached to? (0 disables the plugin) <a target="_blank" href="https://pinout.xyz/">Pinout help</a></span>
            <div class="alert alert-error hidden" id="emergencystopreloaded_settings_badpin">
                <i class="fas fa-info icon-info-sign iconRight"></i>
                {{ _('Warning: The selected pin is not a suitable GPIO ( Ground, voltage, reserved or invalid ).') }}
            </div>
        </div>
    </div>

    <div class="control-group">
        <label class="control-label" for="emergencystopreloaded_settings_powerInput">{{ _('Button is connected to') }}</label>
        <div class="controls">
            <select id="emergencystopreloaded_settings_powerInput" data-bind="value: settingsViewModel.settings.plugins.emergencystopreloaded.power, disable:printing" required>
                <option value=0>{{ _('Ground') }}</option>
                <option value=1>{{ _('3.3V') }}</option>
            </select>
            <span class="help-block">Specify how the button is connected. One end of the button must be wired to ground or 3.3V.</span>
			
			<div class="alert alert-warn hidden" id="emergencystopreloaded_settings_pullupwarn">
				<i class="fas fa-info icon-info-sign iconRight"></i>
				Warning: Pins 3 and 5 (Board mode) or pins 2 and 3 (BCM mode) have a physical pull up resistor. If the button is connected to 3.3V this plugin won't work.
			</div>
			
            <div class="alert alert-error">
                <i class="fas fa-exclamation icon-warning-sign iconRight"></i>
                Warning: Never connect the sensor to 5V! That could destroy your Raspberry Pi's GPIO.
            </div>
        </div>
    </div>

    <div class="control-group">
        <label class="control-label">{{ _('Switch type') }}</label>
        <div class="controls">
            <select id="emergencystopreloaded_settings_triggeredInput" data-bind="value: settingsViewModel.settings.plugins.emergencystopreloaded.triggered, disable:printing" required>
                <option value=0>{{ _('Triggered when open') }}</option>
                <option value=1>{{ _('Triggered when closed') }}</option>
            </select>
            <span class="help-block">Select if the emergency stop is triggered when the switch is open or closed.</span>
        </div>
    </div>

    <div class="control-group">
        <div class="controls">
            <input type="button" class="btn btn-info" data-bind="click: testSensor, disable:printing" value="Test sensor">
            <br/>
            <br/>
            <strong id="emergencystopreloaded_settings_testResult" data-bind="html: testSensorResult"></strong>
        </div>
    </div>

    <div class="control-group">
        <label class="control-label" for="emergencystopreloaded_settings_commandInput">G-code</label>
        <div class="controls">
            <textarea id="emergencystopreloaded_settings_commandInput" class="block" data-bind="value: settingsViewModel.settings.plugins.emergencystopreloaded.g_code, disable:printing"></textarea>
            <span class="help-block">Which G-command(s) will be sent to the printer when the sensor is triggered. Visit <a href="https://www.reprap.org/wiki/G-code" target="_blank">the RepRap wiki</a> to learn more about G-code.</span>
        </div>

    </div>
	
	<div>
		<div>
			<small>
				<a href="#" class="muted" onclick="$(this).children().toggleClass('fa-caret-right fa-caret-down').parent().parent().parent().next().slideToggle('fast')">
					<i class="fa fa-caret-right"></i> {{ _('Advanced options') }}</a>
			</small>
		</div>
		
		<div class="hide">
		
			<p>Judging the switch's state is achieved in two steps. First of all there is a simple edge detection attached to the defined GPIO pin. A level change leads to an additonal more reliable measurement which is done by reading the state of the configured GPIO pin multiple times.</p>
		
			<div class="alert alert-warn" >
				<i class="fas fa-info icon-info-sign iconRight"></i>
				Warning! Increasing the following values may lead to longer response times when actuating the switch. Touch them only if your sensor gets triggered randomly or does not trigger at all.
			</div>
			
			<div class="control-group">
			
				<label for="emergencystopreloaded_settings_bounce_time" class="control-label">{{ _('Bounce time') }}</label>
				<div class="controls">
					<input type="number" step="1" min="1" placeholder="ms" title="Milliseconds" class="input-mini" id="emergencystopreloaded_settings_bounce_time" data-bind="value: settingsViewModel.settings.plugins.emergencystopreloaded.bounce_time, disable:printing">
					<span class="help-block">Define the <a href="https://en.wikipedia.org/wiki/Switch#Contact_bounce" target="_blank">bounce time</a> in milliseconds for the edge detection.</span>
				</div>
				
			</div>
		
			<div class="control-group">
			
				<label for="emergencystopreloaded_settings_reading_iterations" class="control-label">{{ _('Reading iterations') }}</label>
				<div class="controls">
					<input type="number" step="1" min="1" class="input-mini" id="emergencystopreloaded_settings_reading_iterations" data-bind="value: settingsViewModel.settings.plugins.emergencystopreloaded.reading_iterations, disable:printing">
					<span class="help-block">Define the number of readings to perform when taking a precise measurement.</span>
				</div>
				
			</div>
		
			<div class="control-group">
			
				<label for="emergencystopreloaded_settings_reading_delay" class="control-label">{{ _('Reading delay') }}</label>
				<div class="controls">
					<input type="number" step="1" min="0" placeholder="ms" title="Milliseconds" class="input-mini" id="emergencystopreloaded_settings_reading_delay" data-bind="value: settingsViewModel.settings.plugins.emergencystopreloaded.reading_delay, disable:printing">
					<span class="help-block">Define the delay in milliseconds between those readings.</span>
				</div>
				
			</div>
			
        </div>
	</div>

    <br>

    <p>For further information click <a target="_blank" href="https://github.com/CMR-DEV/OctoPrint-EmergencyStopReloaded">here</a></p>

</form>
